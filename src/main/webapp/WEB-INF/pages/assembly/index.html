<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>邂逅活动</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <link rel="stylesheet" href="${request.contextPath}/css/assembly/swiper.min.css">
    <link rel="stylesheet" href="${request.contextPath}/css/assembly/main.css">
    <style>
        .infinite-scroll-preloader {
            margin-top:-20px;
        }
        .buttons-tab .button {
            color: #5f646e;
            font-size: 0.6rem;
            width: 100%;
            height: 2rem;
            line-height: 2rem;
            -webkit-box-flex: 1;
            -ms-flex: 1;
            border: 0;
            border-bottom: 2px solid transparent;
            border-radius: 0;
        }
    </style>
  </head>
  <body>

  <div class="page-group">
      <!-- 你的html代码 -->
      <div class="page">
          <div class="indexHeader header">
              <div class="buttons-tab">
                  <a href="#tab1" onclick="checkTab('online')" class="tab-link <#if type=='online'>active</#if> button">线上活动</a>
                  <a href="#tab2" onclick="checkTab('face')"   class="tab-link <#if type=='face'>active</#if> button">线下活动</a>
                  <a href="#tab3"  onclick="checkTab('train')"  class="tab-link <#if type=='train'>active</#if> button">培训分享</a>
                  <a href="#tab4" onclick="checkTab('company')"  class="tab-link <#if type=='company'>active</#if> button">企业参访</a>
              </div>
          </div>
          <div class="bar bar-header-secondary">
              <div class="cities">
                  <select class="citySelect">
                      <option value="广州">广州</option>
                      <option value="上海">上海</option>
                      <option value="北京">北京</option>
                      <option value="西安">西安</option>
                      <option value="重庆">重庆</option>
                      <option value="青岛">青岛</option>
                      <option value="大连">大连</option>
                      <option value="武汉">武汉</option>
                      <option value="成都">成都</option>
                      <option value="长沙">长沙</option>
                      <option value="沈阳">沈阳</option>
                      <option value="哈尔滨">哈尔滨</option>
                      <option value="安徽">安徽</option>
                      <option value="南京">南京</option>
                      <option value="福建">福建</option>
                  </select>
              </div>
              <div class="searchbar" id="searchBar">
                  <div class="search-input">
                      <input style="" type="search" id='search' placeholder='输入关键字...' />
                      <input type="hidden" id="searchType" value="${type}"/>
                  </div>
              </div>
              <div class="searchIcon" onclick="select()">
                  <label class="icon icon-search"></label>
              </div>
          </div>
          <!--<#if userInfo.acountType=="VIP">-->
              <!--<nav class="bar bar-tab indexBottom">-->
                  <!--<a class="tab-item external" href="javaScript:void(0)" onclick="toAdd()">-->
                      <!--<img class="addActivityImg" src="${request.contextPath}/images/assembly/addActivity.png" />-->
                  <!--</a>-->
              <!--</nav>-->
          <!--</#if>-->
              <div class="indexContent content infinite-scroll  infinite-scroll-bottom " data-ptr-distance="100">
                  <div class="content-block">
                      <div class="swiper-container">
                          <div class="swiper-wrapper">
                              <#list assemblyList as assembly>
                                  <div class="swiper-slide">
                                      <a class="external" href="#" onclick="toDetail('${assembly.assemblyId}')">
                                          <#if assembly.titleImg!="">
                                              <img src="${assembly.titleImg}" data-id="${assembly.assemblyId}"  style="width:100%;height: calc(460/750*100vw)"/>
                                              <#else>
                                                  <img src="${request.contextPath}/images/assembly/default_tImage.jpg" />
                                          </#if>

                                      </a>
                                  </div>
                              </#list>
                          </div>
                      </div>
                      <div class="tabs">
                          <div id="tab1" class="tab <#if type=='online' || type==''>active</#if>">
                          </div>
                          <div id="tab2"class="tab <#if type=='face'>active</#if>">

                          </div>
                          <div id="tab3"  class="tab  <#if type=='train'>active</#if>">
                          </div>
                          <div id="tab4" class="tab <#if type=='company'>active</#if>">
                          </div>
                      </div>
                  </div>
              </div>
       </div>
  </div>

    <script type='text/javascript' src='http://g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script src="${request.contextPath}/js/assembly/swiper.min.js"></script>
    <script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
  <script type='text/javascript' src='https://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>

  <script>
        wx.config({
            appId: "${parmsMap['appId']}", // 必填，公众号的唯一标识
            timestamp:${parmsMap['timestamp']} , // 必填，生成签名的时间戳
            nonceStr: "${parmsMap['nonceStr']}", // 必填，生成签名的随机串
            signature: "${parmsMap['signature']}",// 必填，签名，见附录1
            jsApiList: [
                'checkJsApi',
                'onMenuShareTimeline',
                'onMenuShareAppMessage',
                'onMenuShareQQ'
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });
        var shareImgUrl="";
        shareImgUrl="${request.contextPath}/images/assembly/default_tImage.jpg";
        if(shareImgUrl.indexOf('http') == -1){
            shareImgUrl = 'http://www.xiehoushike.com'+shareImgUrl;
        }
        wx.ready(function(){
            wx.onMenuShareAppMessage({
                title: '邂逅拾刻-邂逅活动',
                desc: "邂逅活动",
                link: window.location.href,
                imgUrl: shareImgUrl,
                trigger: function (res) {
                    //  alert('用户点击发送给朋友');
                },
                success: function (res) {
                    //     $.toast('已分享');
                },
                cancel: function (res) {
                    //      $.toast('已取消分享');
                },
                fail: function (res) {
                    //      console.log('失败');
                }
            });
            wx.onMenuShareTimeline({
                title: "邂逅拾刻-邂逅活动", // 分享标题
                link: window.location.href, // 分享链接
                imgUrl: shareImgUrl, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

        });
        $(function(){
            if("${type}"==""){
                $("#tab1").load("${request.contextPath}/assembly/searchAssembly");
            }
            if("${type}"=="online"){
                $("#tab1").load("${request.contextPath}/assembly/searchAssembly?type=online");
            }
            if("${type}"=="face"){
                $("#tab2").load("${request.contextPath}/assembly/searchAssembly?type=train");
            }
            if("${type}"=="train"){
                $("#tab3").load("${request.contextPath}/assembly/searchAssembly?type=train");
            }
            if("${type}"=="company"){
                $("#tab4").load("${request.contextPath}/assembly/searchAssembly?type=company");
            }
            //调整搜索框长度
            (function(){
                var barWidth = $('.bar-header-secondary').width();
                var searchIconWidth = $('.searchIcon').width();
                var cityWidth = $('.cities').width();
                var searchBarWidth = (barWidth-searchIconWidth-cityWidth);
                $('.searchbar').width(searchBarWidth);
                $(document).on("click",".searchIcon",function () {
                })
                $(document).on("change",".citySelect",function () {
                    var type=$("#searchType").val();
                    var citySelect=$(".citySelect").val();
                    $('.pull-to-refresh-content .content-block').html('');
                    if(type=="online"){
                        $("#tab1").load("${request.contextPath}/assembly/searchAssembly?type=online&citySelect="+citySelect);
                    }
                    if(type=="face"){
                        $("#tab2").load("${request.contextPath}/assembly/searchAssembly?type=face&citySelect="+citySelect);
                    }
                    if(type=="train"){
                        $("#tab3").load("${request.contextPath}/assembly/searchAssembly?type=train&citySelect="+citySelect);
                    }
                    if(type=="company"){
                        $("#tab4").load("${request.contextPath}/assembly/searchAssembly?type=company&citySelect="+citySelect);
                    }
                    if(type==""){
                        $("#tab1").load("${request.contextPath}/assembly/searchAssembly?type=&citySelect="+citySelect);
                    }
                })
            }());

        })
        $.init();
        function select(){
            var searchName=$("#search").val();
            var type=$("#searchType").val();
            var citySelect=$(".citySelect").val();
            $('.infinite-scroll-bottom.content-block').html('');
            if(type=="" || type=="online"){
                $("#tab1").load("${request.contextPath}/assembly/searchAssembly?type="+type+"&searchName="+searchName);
            }
            if(type=="face"){
                $("#tab2").load("${request.contextPath}/assembly/searchAssembly?type="+type+"&searchName="+searchName);
            }
            if(type=="train"){
                $("#tab3").load("${request.contextPath}/assembly/searchAssembly?type="+type+"&searchName="+searchName);
            }
            if(type=="company"){
                $("#tab4").load("${request.contextPath}/assembly/searchAssembly?type="+type+"&searchName="+searchName);
            }
        }
        function toAdd() {
            var backUrl = 'http://www.xiehoushike.com'+'${request.contextPath}/assembly/to-add';
           window.location.href = '${request.contextPath}/wx/to-get-open-id?backUrl='+encodeURIComponent(backUrl);
            //    window.location.href = '${request.contextPath}/assembly/to-add';
        }
        function  checkTab(type) {
            $("#searchType").val(type);
            var citySelect=$(".citySelect").val();
            if(type=="online"){
                $("#tab1").load("${request.contextPath}/assembly/searchAssembly?type=online&citySelect="+citySelect);
            }
            if(type=="face"){
                $("#tab2").load("${request.contextPath}/assembly/searchAssembly?type=face&citySelect="+citySelect);
            }
            if(type=="train"){
                $("#tab3").load("${request.contextPath}/assembly/searchAssembly?type=train&citySelect="+citySelect);
            }
            if(type=="company"){
                $("#tab4").load("${request.contextPath}/assembly/searchAssembly?type=company&citySelect="+citySelect);
            }
        }
      function toDetail(assemblyId) {
          var backUrl = 'http://www.xiehoushike.com'+'${request.contextPath}/assembly/to-detail?assemblyId='+assemblyId;
           window.location.href = '${request.contextPath}/assembly/to-detail?assemblyId='+assemblyId;

          // window.location.href = '${request.contextPath}/wx/to-get-open-id?backUrl='+encodeURIComponent(backUrl);
      }
    </script>
  </body>
</html>
