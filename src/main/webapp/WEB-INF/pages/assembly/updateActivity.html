<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>活动发布</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">
    <link rel="stylesheet" href="${request.contextPath}/css/assembly/main.css">
    <link rel="stylesheet" href="${request.contextPath}/css/upload.css">
</head>
<body>
<div class="page-group">
    <div class="page page-current" id="routerActivityPublish">
        <div class="activityPublishHeader header">
            <h1 class="title">活动发布</h1>
            <a class="button button-link button-nav back pull-left" external href="${request.contextPath}/assembly/myAssembly">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish"  external href="javaScript:void(0)" onclick="saveAssembly()">
                发布
            </a>
            <a class="button button-link button-nav  pull-right" style="border: none;margin-top: 0.4rem;" href="#viewAssembly" onclick="viewAssembly()" >
                预览
            </a>
        </div>
        <div class="content activityPublishContent">
            <form id="saveAssemblyForm" name="saveAssemblyForm" type="post">
                <input type="hidden" id="imageType" name="imageType" value=""/>
                <input type="hidden" id="assemblyId" name="assemblyId" value="${assembly.assemblyId}"/>
                <div class="list-block">
                <ul>
                    <li class="activitySubject">
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">活动主题</div>
                                <div class="item-input">
                                    <input type="text" name="assemblyTitle" placeholder="" value="${assembly.title}">
                                </div>
                                <a class="subjectPicture" href="#routerAddWallpaper" onclick="updateType('ASSEMBLY_SHOW_IMG')"> | <span class="icon icon-picture choosePicture" ></span></a>
                                    <input type="hidden"  name="imageIdStr" value="${assembly.titleImageId}">
                                    <input type="hidden"  name="imageUrlStr" value="${assembly.titleImg}">
                            </div>
                        </div>

                    </li>
                </ul>
                <ul>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">活动开始时间</div>
                                <div class="item-input">
                                    <input  type="text" class="datetimePickerStartTime" name="startTime" placeholder="" value="${assembly.startTime}">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">活动结束时间</div>
                                <div class="item-input">
                                    <input type="text" class="datetimePickerEndTime" name="endTime" placeholder="" value="${assembly.endTime}">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label" style="width:33%">活动举办地点</div>
                                <div class="cities">
                                    <select class="citySelect" >
                                        <option value="北京" <#if assembly.rendezvous?contains("北京")>selected</#if>>北京</option>
                                        <option value="重庆" <#if assembly.rendezvous?contains("重庆")>selected</#if>>重庆</option>
                                        <option value="大连" <#if assembly.rendezvous?contains("大连")>selected</#if>>大连</option>
                                        <option value="广州" <#if assembly.rendezvous?contains("广州")>selected</#if>>广州</option>
                                        <option value="青岛" <#if assembly.rendezvous?contains("青岛")>selected</#if>>青岛</option>
                                        <option value="上海" <#if assembly.rendezvous?contains("上海")>selected</#if>>上海</option>
                                        <option value="苏州" <#if assembly.rendezvous?contains("苏州")>selected</#if>>苏州</option>
                                        <option value="四川" <#if assembly.rendezvous?contains("四川")>selected</#if>>四川</option>
                                        <option value="武汉" <#if assembly.rendezvous?contains("武汉")>selected</#if>>武汉</option>
                                        <option value="西安" <#if assembly.rendezvous?contains("西安")>selected</#if>>西安</option>
                                    </select>
                                </div>
                                <div class="item-input">
                                    <input type="text" placeholder="" name="rendezvous" value="${assembly.rendezvous}">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li style="padding-bottom:.5rem;">
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">活动详细描述</div>
                                <div class="item-input activityDescImgs">
                                    <input type="hidden"  name="imageIdStrDesc" value="${assembly.contentImgIds}">
                                    <input type="hidden"  name="imageUrlStrDesc" value="">

                                    <a class="subjectPicture" href="#routerAddWallpaper" onclick="updateType('ASSEMBLY_CONTENT_IMG')">
                                        <img src="${request.contextPath}/images/assembly/icon/publishImg.png" /></a>
                                </div>
                            </div>
                        </div>
                        <div class="imgShow" style="text-align: center">
                        <#list assembly.contentImgList as contentImg>
                                <img src="${contentImg.imageUrl}" style="height: 5rem;width: 10rem;"/>
                                <span class="icon icon-remove" data-id="${contentImg.imageId}"></span>
                        </#list>
                        </div>
                        <textarea class="activityDesc" name="description">${assembly.description}</textarea>
                    </li>
                </ul>
                <ul class="activitySettings">

                    <a style="color:black" href="#routerActivityType">  <li>
                        <input type="hidden" name="assemblyType"  value="${assembly.type}"/>活动类型
                        <span class="icon icon-right pull-right"></span>
                    </li>
                    </a>
                    <a style="color:black" href="#routerActivityFee"><li>
                        <input type="hidden" name="feeId"  value="${assembly.feeIds}"/>
                        报名费用
                            <span class="icon icon-right pull-right"></span>
                    </li></a>
                    <a style="color:black" href="#routerEnrollSetting"> <li>
                        <input type="hidden" name="onApply"  value="${assembly.isOnApply}"/>
                        <input type="hidden" name="phoneNumber"  value="${assembly.phoneNumber}"/>
                        <input type="hidden" name="applyId"  value="${assembly.showApplyProblem}"/>
                         报名设置
                            <span class="icon icon-right pull-right"></span>
                    </li></a>
                    <a style="color:black" href="#routerAddWallpaper" onclick="updateType('ASSEMBLY_CONSULTATION_IMG')"><li>
                        <input type="hidden"  name="imageIdStrCon" value="${assembly.consultationImgId}">
                        <input type="hidden"  name="imageUrlStrCon" value="${assembly.consultationImg}">
                        咨询二维码
                            <span class="icon icon-right pull-right"></span>
                    </li></a>
                </ul>
            </div>
            </form>
        </div>
    </div>

    <div class="page" id="routerActivityType">
        <div class="activityPublishHeader header">
            <h1 class="title">活动类型</h1>
            <a class="button button-link button-nav back pull-left">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish">
                完成
            </a>
        </div>

        <div class="content activityPublishContent">
            <div class="list-block">
                <ul class="activityTypes">
                    <li>
                        线上活动
                        <span class="pull-right">
                            <label radioName="activityType" class="radioLabel <#if assembly.type=='online'>checked</#if>" id="activityType1"></label>
                            <input for="activityType1" name="activityType"<#if assembly.type=='online'>checked</#if> type="radio"  value="1">
                        </span>
                    </li>
                    <li>
                        线下活动
                        <span class="pull-right">
                            <label radioName="activityType" class="radioLabel <#if assembly.type=='face'>checked</#if>" id="activityType2"></label>
                            <input for="activityType2" name="activityType" <#if assembly.type=='face'>checked</#if> type="radio" value="2">
                        </span>
                    </li>
                    <li>
                        培训分享
                        <span class="pull-right">
                            <label radioName="activityType" class="radioLabel <#if assembly.type=='train'>checked</#if>" id="activityType3"></label>
                            <input for="activityType3" name="activityType"  <#if assembly.type=='train'>checked</#if> type="radio" value="3">
                        </span>
                    </li>
                    <li>
                        企业参访
                        <span class="pull-right">
                            <label radioName="activityType" class="radioLabel <#if assembly.type=='company'>checked</#if>" id="activityType4"></label>
                            <input for="activityType4" name="activityType"  <#if assembly.type=='company'>checked</#if> type="radio" value="4">
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="page" id="routerAddWallpaper">
        <div class="activityPublishHeader header">
            <h1 class="title">添加海报</h1>
            <a class="button button-link button-nav back pull-left">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish">
                完成
            </a>
        </div>
        <div class="content activityPublishContent">
            <div class="list-block">
                <input type="hidden" id="imageId" value=""/>
                <img src="" id="imageUrl" style="display: none;margin: 0 auto;height: 9rem;width: 16rem;"/>
                <div class="main-wrap">
                    <div id="uploader">
                        <div class="queueList fix">
                            <div class="filelist"></div>
                            <div id="filePicker">
                                <label class="trigger">+</label>
                                <input type="file" name="file" class="webuploader-element-invisible" accept="image/*">
                            </div>
                        </div>
                        <div class="progress-box">
                            <div class="progress">
                                <span class="text">0%</span>
                                <span class="percentage"></span>
                            </div><div class="info"></div>
                        </div>
                    </div>
                </div>
                <input type="button" value="确定" id="saveImgBtn" class="button button-fill button-danger button-big" style="margin: 1rem;width: 90%"/>
            </div>
        </div>
    </div>

    <div class="page" id="routerActivityFee">
        <div class="activityPublishHeader header">
            <h1 class="title">报名费用</h1>
            <a class="button button-link button-nav back pull-left">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish" onclick="saveFee()">
                完成
            </a>
        </div>

        <div class="content activityPublishContent">
            <form type="post" id="addFee" name="addFee" >
            <div class="list-block">
                <ul class="fees">
                <#list assembly.feeList as fee>
                   <#if fee_index gt 0>
                       <li class="feeSpacingLine"></li>
                       <li >
                           <div class="item-content">
                               <div class="item-inner">
                                   <div class="item-title label">费用名称</div>
                                   <div class="item-input">
                                       <input type="hidden" placeholder="" name="feeIds" value="${fee.feeId}">
                                       <input type="text" placeholder="" name="feeTitle" value="${fee.feeTitle}">
                                   </div>
                               </div>
                           </div>
                       </li>
                       <li >
                           <div class="item-content">
                               <div class="item-inner">
                                   <div class="item-title label">金额(元)</div>
                                   <div class="item-input">
                                       <input type="text" placeholder="" value="${fee.fee}" onkeyup="if(/\D/.test(this.value)){$.alert('只能输入数字');this.value='';}" name="feeStr">
                                   </div>
                               </div>
                           </div>
                       </li>
                       <li >
                           <div class="item-content">
                               <div class="item-inner">
                                   <div class="item-title label">名额限制(人)</div>
                                   <div class="item-input">
                                       <input type="text" placeholder="" onkeyup="if(/\D/.test(this.value)){$.alert('只能输入数字');this.value='';}" name="quota" value="${fee.quota}">
                                   </div>
                               </div>
                           </div>
                       </li>

                       <#else>
                           <li class="feeItemDefault">
                               <div class="item-content">
                                   <div class="item-inner">
                                       <div class="item-title label">费用名称</div>
                                       <div class="item-input">
                                           <input type="hidden" placeholder="" name="feeIds" value="${fee.feeId}">
                                           <input type="text" placeholder="" name="feeTitle" value="${fee.feeTitle}">
                                       </div>
                                   </div>
                               </div>
                           </li>
                           <li class="feeItemDefault">
                               <div class="item-content">
                                   <div class="item-inner">
                                       <div class="item-title label">金额(元)</div>
                                       <div class="item-input">
                                           <input type="text" placeholder="金额不能少于2元" value="${fee.fee}" onkeyup="if(/\D/.test(this.value)){$.alert('只能输入数字');this.value='';} if(this.value!='' && this.value<2){$.alert('金额不能少于2元');this.value='';}" name="feeStr">
                                       </div>
                                   </div>
                               </div>
                           </li>
                           <li class="feeItemDefault">
                               <div class="item-content">
                                   <div class="item-inner">
                                       <div class="item-title label">名额限制(人)</div>
                                       <div class="item-input">
                                           <input type="text" placeholder="" onkeyup="if(/\D/.test(this.value)){$.alert('只能输入数字');this.value='';}" name="quota" value="${fee.quota}">
                                       </div>
                                   </div>
                               </div>
                           </li>
                   </#if>
                </#list>
                </ul>
                <span class="addFeeItem">+添加费用项</span>
            </div>
            </form>
        </div>
    </div>


    <div class="page" id="routerEnrollSetting">
        <div class="activityPublishHeader header">
            <h1 class="title">报名设置</h1>
            <a class="button button-link button-nav back pull-left">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish" onclick="saveSetting()">
                完成
            </a>
        </div>

        <div class="content activityPublishContent">
            <div class="list-block">
                <ul class="fees">
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">联系方式</div>
                                <div class="item-input">
                                    <input type="text" placeholder="手机号/座机号/微信号" name="phoneNumberStr" value="${assembly.phoneNumber}">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label" style="overflow: visible;">活动结束前均可报名</div>
                                <div class="item-input">
                                    <label class="label-switch pull-right">
                                        <input type="checkbox" name="onApplyStr" value="${assembly.isOnApply}" <#if assembly.isOnApply=="true">checked</#if>>
                                        <div class="checkbox"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </li>
                    </ul>

                    <div class="formDesc">设置用户报名时的必填项</div>
                    <ul class="customItems">
                        <li class="customItemDefault">
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title label">姓名</div>
                                <span class="pull-right">
                                    <label class="checkboxLabel <#if assembly.showApplyProblem?contains('userName')>checked</#if>" id="nameRequireLabel"></label>
                                    <input for="nameRequireLabel" name="nameCheckbox" type="checkbox" <#if assembly.showApplyProblem?contains('userName')>checked</#if> value="userName">
                                </span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title label">电话</div>
                                    <span class="pull-right">
                                        <label class="checkboxLabel <#if assembly.showApplyProblem?contains('phone')>checked</#if>" id="phoneRequireLabel" ></label>
                                        <input for="phoneRequireLabel" name="nameCheckbox" <#if assembly.showApplyProblem?contains('phone')>checked</#if> type="checkbox" value="phone">
                                    </span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title label">微信号</div>
                                    <span class="pull-right">
                                        <label class="checkboxLabel <#if assembly.showApplyProblem?contains('wx')>checked</#if>" id="WXRequireLabel"></label>
                                        <input for="WXRequireLabel" name="nameCheckbox" type="checkbox" <#if assembly.showApplyProblem?contains('wx')>checked</#if> value="wx">
                                    </span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title label">邮箱</div>
                                    <span class="pull-right">
                                        <label class="checkboxLabel <#if assembly.showApplyProblem?contains('email')>checked</#if>" id="emailRequireLabel"></label>
                                        <input for="emailRequireLabel" name="nameCheckbox" type="checkbox" <#if assembly.showApplyProblem?contains('email')>checked</#if> value="email">
                                    </span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="item-content">
                                <div class="item-inner">
                                    <div class="item-title label">所在企业</div>
                                    <span class="pull-right">
                                        <label class="checkboxLabel <#if assembly.showApplyProblem?contains('email')>checked</#if>" id="companyRequireLabel"></label>
                                        <input for="companyRequireLabel" name="nameCheckbox" <#if assembly.showApplyProblem?contains('company')>checked</#if> type="checkbox" value="company">
                                    </span>
                                </div>
                            </div>
                        </li>
                    </ul>
            </div>
        </div>
    </div>
    <div class="page" id="viewAssembly">
        <div class="activityPublishHeader header">
            <h1 class="title">活动预览</h1>
            <a class="button button-link button-nav back pull-left">
                <span class="icon icon-left"></span>
                返回
            </a>
            <a class="button button-link button-nav back pull-right publish" onclick="saveSetting()">
                完成
            </a>
        </div>

        <div class="content activityContent">
            <div class="content-block">
                <img class="fullWidth" src="${assembly.titleImg}"  id="titleImg" />
                <h4 class="activityTitle"></h4>
                <div class="activityDesc">
                    <span id="createTime"></span>
                    <img class="eyeImg" src="${request.contextPath}/images/assembly/icon/eye.svg" />
                    <span class="viewNum">0</span>
                </div>
                <div class="activityRow">
                    <img class="clockImg"  src="${request.contextPath}/images/assembly/icon/clock.png"/>
                    <span id="viewTime"></span>
                </div>
                <div class="activityRow">
                    <img src="${request.contextPath}/images/assembly/icon/type.png" />
                    <span id="assemblyTypeText">
                        <#if assembly.type=="online">
                        <span>线上活动</span>
                        <#elseif  assembly.type=="face">
                            <span>线下活动</span>
                            <#elseif assembly.type=="train">
                                <span>培训分享</span>
                                <#elseif assembly.type=="company">
                                    <span>企业参访</span>
                    </#if></span>
                </div>
                <div class="activityRow">
                    <img src="${request.contextPath}/images/assembly/icon/human.png" />
                    <span>已报名0人</span>
                </div>
                <div class="activityRow">
                    <img src="${request.contextPath}/images/assembly/icon/type.png" />
                    <span id="rendezvous">${assembly.rendezvous}</span>
                </div>

                <div class="activityRow">
                    <img class="moneyImg" src="${request.contextPath}/images/assembly/icon/money.png" />
                    <span class="money">${minMoney} -${maxMoney}</span>
                </div>

                <div class="userRow">
                    <img class="userPhoto" src="${userInfo.headImgPath}" align="left" style="border-radius:35px"/>
                    <span class="userName">${userInfo.nickName}</span>
                    <span class="darkBg">主办方</span>
                </div>

                <div class="activityDetailWrap" style="height: 18.8rem;z-index:2;position:relative;">
                    <div class="activityDetail">
                        <div class="imgShowText" style="text-align: center">
                            <#list assembly.contentImgList as contentImg>
                                <img src="${contentImg.imageUrl}" style="height: 5rem;width: 10rem;"/>
                            </#list>
                        </div>
                         <div id="description">${assembly.description}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type='text/javascript' src='${request.contextPath}/js/zepto.min.js' charset='utf-8'></script>
<script type='text/javascript' src='${request.contextPath}/js/upload.js?v=20160720-2' charset='utf-8'></script>
<script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
<script type='text/javascript' src='${request.contextPath}/js/assembly/main.js' charset='utf-8'></script>
<style>
    .activityRow {
        color: #40445e;
        vertical-align: top;
        padding-left: 1.8rem;
        height: 1.6rem;
        line-height: 1.6rem;
        position: relative;
        font-size: .75rem;
    }
    .activityRow img {
        width: 1rem;
        position: absolute;
        left: 0.8rem;
        top: .2rem;
    }
</style>
<script>
    $(function(){
        $(".datetimePickerStartTime").click(function(){
            var dt = new Date("${assembly.startTime}");
            var year =dt.getFullYear();
            var month =dt.getMonth()+1;
            if(month<10) month='0'+month;
            var day = dt.getDate();
            if(day<10) day='0'+day;
            var hour =dt.getHours();
            if(hour<10) hour='0'+hour;
            var minute= dt.getMinutes();
            if(minute<10)minute='0'+minute;
            $(this).datetimePicker({
                value: [year, month, day, hour, minute]
            });
    })
        $(".datetimePickerEndTime").click(function(){
            var dt = new Date("${assembly.endTime}");
            var year =dt.getFullYear();
            var month =dt.getMonth()+1;
            if(month<10) month='0'+month;
            var day = dt.getDate();
            if(day<10) day='0'+day;
            var hour =dt.getHours();
            if(hour<10) hour='0'+hour;
            var minute= dt.getMinutes();
            if(minute<10)minute='0'+minute;
            $(this).datetimePicker({
                value: [year, month, day, hour, minute]
            });
        })
        $(document).on('beforePageSwitch', '#routerAddWallpaper', function(){
            var imageId = $('#imageId').val();
            var imageType= $('#imageType').val();
            var imageUrl=$('#imageUrl')[0].src;
            if(imageId!=""){
                if(imageType=="ASSEMBLY_SHOW_IMG"){
                    $("input[name='imageIdStr']").val(imageId);
                    $("input[name='imageUrlStr']").val(imageUrl);
                    $("#titleImg").attr("src",imageUrl);
                }else if(imageType=="ASSEMBLY_CONTENT_IMG") {
                    $("input[name='imageIdStrDesc']").val($("input[name='imageIdStrDesc']").val()+","+imageId);
                    var html='<img src="'+imageUrl+'" style="height: 5rem;width: 10rem;"/><span class="icon icon-remove" data-id="'+imageId+'"></span>'
                    $(".imgShow").append(html);
                    var htmlText='<img src="'+imageUrl+'" style="width: 100%;"/>'
                    $(".imgShowText").append(htmlText);
                }else if(imageType=="ASSEMBLY_CONSULTATION_IMG"){
                    $("input[name='imageIdStrCon']").val(imageId);
                    $("input[name='imageUrlStrCon']").val(imageUrl);
                }
            }
        });
        $(document).on('beforePageSwitch', '#routerActivityType', function(){
            var value=$('input[name="activityType"]:checked').val();
            var assemblyType="";
            var assemblyTypeText="";
            if(value=="1"){
                assemblyType="online";
                assemblyTypeText="线上活动"
            }else if(value=="2"){
                assemblyType="face";
                assemblyTypeText="线下活动"
            }else if(value=="3"){
                assemblyType="train";
                assemblyTypeText="培训分享"
            }else if(value=="4"){
                assemblyType="company";
                assemblyTypeText="企业参访"
            }
            $('input[name="assemblyType"]').val(assemblyType)
            $("#assemblyTypeText").html(assemblyTypeText)
        });
        //添加费用项
        $('.addFeeItem').click(function(){
            var $fees = $(this).parent().find('.fees');
            var $defaultFeeItems = $fees.find('li.feeItemDefault');
            var feeSpacingLine = $('<li class="feeSpacingLine"></li>');
            var $newItems = $defaultFeeItems.clone();
            $newItems.removeClass('feeItemDefault');
            $newItems.find('input').val('');
            $fees.append(feeSpacingLine).append($newItems);
        });
        $(document).on("click",".imgShow .icon-remove",function () {
            var imageId=$(this).attr("data-id");
            var $this=$(this);
            $.post("${request.contextPath}/assembly/deleteImg?imageId="+imageId,function (data) {
                if (data=="ERROR"){
                    $.alert("删除失败，请稍候重试!");
                }else{
                    $this.prev("img").remove();
                    $this.remove();
                    $("input[name='imageIdStrDesc']").val($("input[name='imageIdStrDesc']").val().replace(imageId,""));
                }
           });
        });
    })
    $.init();
    function saveFee(){
        var feeTitle=$("input[name='feeTitle']").val();
        var feeStr=$("input[name='feeStr']").val();
        var quota=$("input[name='quota']").val();
        if(feeTitle==""){
            $.alert("费用名称不能为空!");
            return false;
        }
        if(feeStr==""){
            $.alert("金额不能为空!");
            return false;
        }
        if(quota==""){
            $.alert("名额限制不能为空!");
            return false;
        }
        var minMoney=0;
        var maxMoney=0;
        $("input[name='feeStr']").each(function (data) {
            var money=$(this).val();
            if(minMoney==0){
                minMoney=money;
            }
            if(maxMoney==0){
                maxMoney=money;
            }
            if(money<minMoney){
                minMoney=money;
            }
            if(money>maxMoney){
                maxMoney=money;
            }
        })
        var params=$("#addFee").serialize();
        $.post("${request.contextPath}/assembly/saveFee",params,function (data) {
            if(data=="ERROR"){
                $.alert("保存失败，请稍后再试!");
            }else{
                $('input[name="feeId"]').val(data)
            }
        })
    };
    function saveSetting() {
       var phoneNumberStr= $('input[name="phoneNumberStr"]').val()
        var onApplyStr= $('input[name="onApplyStr"]:checked').val()
        if(onApplyStr==""){
            $.alert("活动结束前报名设置不能为空!");
            return false;
        }
        if(phoneNumberStr==""){
            $.alert("联系方式不能为空!");
            return false;
        }

        var apply="";
        $('input[name="nameCheckbox"]:checked').each(function(){
            if(apply==""){
                apply=$(this).val();
            }else{
                apply=$(this).val()+","+apply;
            }
        })
        $('input[name="applyId"]').val(apply);
        $('input[name="onApply"]').val(onApplyStr);
        $('input[name="phoneNumber"]').val(phoneNumberStr);
    }
    function updateType(type) {
        $("#imageType").val(type);
        var imageIdStr=$("input[name='imageIdStr']").val();
        var imageIdStrDesc= $("input[name='imageIdStrDesc']").val();
        var imageIdStrCon=$("input[name='imageIdStrCon']").val();

        var imageUrlStr=$("input[name='imageUrlStr']").val();
        var imageUrlStrCon=$("input[name='imageUrlStrCon']").val();
        if (type== "ASSEMBLY_SHOW_IMG" ) {
            if(imageIdStr==""){
                $("#imageId").val("");
                $("#imageUrl").attr("src", "");
                $("#imageUrl").css("display", "none");
                $('#filePicker').show();
            }else{
                $("#imageId").val(imageIdStr);
                $("#imageUrl").attr("src", imageUrlStr);
                $("#imageUrl").css("display", "block");
                $('#filePicker').show();
            }
        }
        if (type== "ASSEMBLY_CONTENT_IMG" ) {
            $("#imageId").val("");
            $("#imageUrl").attr("src", "");
            $("#imageUrl").css("display", "none");
            $('#filePicker').show();
        }
        if (type== "ASSEMBLY_CONSULTATION_IMG" ) {
            if(imageIdStrCon==""){
                $("#imageId").val("");
                $("#imageUrl").attr("src", "");
                $("#imageUrl").css("display", "none");
                $('#filePicker').show();
            }else{
                $("#imageId").val(imageIdStrCon);
                $("#imageUrl").attr("src", imageUrlStrCon);
                $("#imageUrl").css("display", "block");
                $('#filePicker').show();
            }
        }
    }
    function  saveAssembly() {
        var rendevous=$("input[name='rendezvous']").val();

        var assemblyTitle=$("input[name='assemblyTitle']").val();
        var startTime=$("input[name='startTime']").val();
        var endTime=$("input[name='endTime']").val();
        var description=$("textarea[name='description']").val();
        var imageIdStrDesc=$("input[name='imageIdStrDesc']").val();
        var assemblyType=$("input[name='assemblyType']").val();
        var feeId=$("input[name='feeId']").val();
        var applyId=$("input[name='applyId']").val();
        if(assemblyTitle==""){
            $.alert("活动主题不能为空!");
            return false;
        }
        if(startTime==""){
            $.alert("开始时间不能为空!");
            return false;
        }
        if(endTime==""){
            $.alert("结束时间不能为空!");
            return false;
        }
        var startNum = parseInt(startTime.replace(/-/g,''),10);
        var endNum = parseInt(endTime.replace(/-/g,''),10);

        if(endTime==""){
            $.alert("结束时间不能为空!");
            return false;
        }
        if(startNum>endNum){
            $.alert("结束时间不能在开始时间之前！");
            return false;
        }
        if( new Date() > Date.parse(startTime)){
            $.alert("开始时间不能在当前时间之前！");
            return false;
        }
        var rendevous=$("input[name='rendezvous']").val();
        if(rendevous==""){
            $.alert("活动地址不能为空!");
            return false;
        }
        var city=$(".citySelect").val();
        if(rendevous.indexOf(city)==-1){
            $("input[name='rendezvous']").val(city+rendevous);

        }
        if(description=="" && imageIdStrDesc==""){
            $.alert("活动描述不能为空!");
            return false;
        }
        if(imageIdStrDesc.length<10){
            $.alert("活动描述图片不能少于1张!");
            return false;
        }
        if(assemblyType==""){
            $.alert("活动类型不能为空!");
            return false;
        }
        if(feeId==""){
            $.alert("报名费用不能为空!");
            return false;
        }
        if(applyId==""){
            $.alert("报名设置不能为空!");
            return false;
        }
        var params=$("#saveAssemblyForm").serialize();
        $.post("${request.contextPath}/assembly/saveAssembly",params,function (data) {
            if(data=="ERROR"){
                $.alert("保存失败，请稍后再试!");
            }else{
                location.href="${request.contextPath}/assembly/to-success?assemblyId="+data;
            }
        })
    }
    function  viewAssembly () {
        var assemblyTitle=$("input[name='assemblyTitle']").val();
        var startTime=$("input[name='startTime']").val();
        var endTime=$("input[name='endTime']").val();
        var description=$("textarea[name='description']").val();
        var rendevous=$("input[name='rendezvous']").val();
        var city=$(".citySelect").val();
        $(".activityTitle").html(assemblyTitle);
        $("#description").html(description);
        var imageTitle=$("input[name='imageUrlStr']").val();
        if(imageTitle==""){
            $("#titleImg").attr("src","${request.contextPath}/images/assembly/default_tImage.jpg");
        }
        var dt = new Date();
        var year =dt.getFullYear();
        var month =dt.getMonth()+1;
        if(month<10) month='0'+month;
        var day = dt.getDate();
        if(day<10) day='0'+day;
        var hour =dt.getHours();
        if(hour<10) hour='0'+hour;
        var minute= dt.getMinutes();
        if(minute<10)minute='0'+minute;
        $("#createTime").html(month+"月"+day+"日"+hour+"时"+minute+"分");
        if(rendevous.indexOf(city)==-1){
            $("#rendezvous").html("地址："+city+rendevous);
        }else{
            $("#rendezvous").html("地址："+rendevous);
        }
        if(startTime!="" && endTime!=""){
            dt = new Date(startTime.replace("-", "/").replace("-", "/"));
            year =dt.getFullYear();
            month =dt.getMonth()+1;
            if(month<10) month='0'+month;
            day = dt.getDate();
            if(day<10) day='0'+day;
            hour =dt.getHours();
            if(hour<10) hour='0'+hour;
            minute= dt.getMinutes();
            if(minute<10)minute='0'+minute;
            var startTimeText=month+"月"+day+"日"+hour+"时"+minute+"分";
            dt = new Date(endTime.replace("-", "/").replace("-", "/"));
            year =dt.getFullYear();
            month =dt.getMonth()+1;
            if(month<10) month='0'+month;
            day = dt.getDate();
            if(day<10) day='0'+day;
            hour =dt.getHours();
            if(hour<10) hour='0'+hour;
            minute= dt.getMinutes();
            if(minute<10)minute='0'+minute;
            var endTimeText=month+"月"+day+"日"+hour+"时"+minute+"分";
                $("#viewTime").html(startTimeText+" 至 "+endTimeText);

        }
    }
        Zepto(function($) {
            var imageId = $('#imageId').val();
            if(imageId != ''){
                $('#imageUrl').css('display','block');
            }
        });
    $("#saveImgBtn").on('click', function () {
        var imageId = $('#imageId').val();
        var imageType= $('#imageType').val();
        var imageUrl = $('#imageUrl')[0].src;
        $.post('/time/assembly/save-img', {imageId:imageId,imgUrl:imageUrl,imageType:imageType}, function(response){
            if(response != 'error'){
                $.alert("保存成功");
                $('#imageId').val(response);
            }
        })
    });
</script>
</body>
</html>
