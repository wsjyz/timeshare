<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>预约</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">      
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="众筹">
    <meta name="Keywords" content="众筹">
    <meta name="Description" content="众筹">
    <link rel="stylesheet" type="text/css" href="${request.contextPath}/css/crowdFunding/sm.min.css">
    <link rel="stylesheet" type="text/css" href="${request.contextPath}/css/crowdFunding/sm-extend.min.css">
    <link rel="stylesheet" type="text/css" href="${request.contextPath}/css/crowdFunding/style.css">
    <script type="text/javascript" src="${request.contextPath}/js/crowdFunding/zepto.min.js"></script>
    <script type="text/javascript" src="${request.contextPath}/js/crowdFunding/config.js"></script>
  </head>
  <body>
    <div class="page-group">
        <div class="page page-current">
        	<!--header start-->
            <header class="bar bar-nav">
              <a class="icon icon-left pull-left back" href="javascript:history.go(-1);"></a>
              <h1 class="title"></h1>
            </header>
            <!--header end-->
            <!--页面内容区域 start-->
            <div class="content">
                <form action="${request.contextPath}/enroll/save" method="post" id="enrollForm">
                <section>
                  <div class="list-block">
                      <ul>
                        <li>
                          <div class="item-content">
                            <div class="item-inner">
                              <div class="item-title label">姓名</div>
                              <div class="item-input">
                                <input type="text" name="userName" placeholder="请输入姓名" value="${enroll.userName}">
                              </div>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="item-content">
                            <div class="item-inner">
                              <div class="item-title label">手机</div>
                              <div class="item-input">
                                <input type="number" placeholder="请输入电话" name="phone" value="${enroll.phone}">
                              </div>
                            </div>
                          </div>
                        </li>
                      </ul>
                  </div>
                  </section>
                  <section>
                  <div class="list-block">
                      <ul>
                        <li>
                          <div class="item-content">
                            <div class="item-inner">
                              <div class="item-title label">公司简称</div>
                              <div class="item-input">
                                <input type="text" placeholder="请输入公司简称" name="corpName"  value="${enroll.corpName}">
                              </div>
                            </div>
                          </div>
                        </li>
                        <li>
                          <div class="item-content">
                            <div class="item-inner">
                              <div class="item-title label">发票抬头</div>
                              <div class="item-input">
                                <input type="text" placeholder="请输入发票抬头" name="invoiceTitle"  value="${enroll.invoiceTitle}">
                              </div>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </div>
                    </section>
                    <div class="content-block">发票类型:普通增值税发票</div>
                    <div class="content-block btn-box">

                        <input type="hidden" id="invoiceType" value="VAT_INVOICE" name="invoiceType">
                        <input type="hidden" id="payStatus" value="WAIT_PAY" name="payStatus">
                        <input type="hidden" id="payAmount" value="${crowdFunding.reservationCost!}" name="payAmount">
                        <input type="hidden" id="crowdfundingId" value="${crowdFunding.crowdfundingId!}" name="crowdfundingId">

                        <a href="#" class="button btn-dark" id="saveEnrollBtn">确定</a>
                        <a href="${request.contextPath}/crowdFunding/toDetail?crowdFundingId=${crowdFunding.crowdfundingId!}" class="button btn-light">取消</a>

                    </div>
                 </form>
            </div>
            <!-- 页面内容区域 end -->
       </div>    
    </div>

	<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm.min.js"></script>
    <script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm-extend.min.js"></script>
	<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm-city-picker.min.js"></script>
    <script type="text/javascript" src="${request.contextPath}/js/crowdFunding/my-js.js"></script>
  </body>
<script>
    $("#saveEnrollBtn").on('click', function () {
        //用户曾经是否购买过
        if("${isAlreadyBuy}"=="true"){
            $.confirm('您已经购买过，还需要继续购买吗？',
                function () {
                    pay();
                }
            );
        }
        else{
            pay();
        }
    });
    function pay(){
        //支付
        $.post('${request.contextPath}/enroll/save', $("#enrollForm").serialize(), function (result) {
            if(result=="NOT_RELEASED"){
                $.toast("该项目已下架或未发布");
            }
            else if(result=="MAX_PEOPLES_OUT"){
                $.toast("该项目报名人数已满");
            }
            else if(result=="TIME_OUT"){
                $.toast("该项目结束已经已到");
            }
            else if(result=="FAILED"){
                $.toast("该项目目前不可报名");
            }
            else{
                window.location.href = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxcd8903dd6a9552eb" +
                    "&redirect_uri=http%3A%2F%2Fjk.zhangqidong.cn%2Ftime%2Fenroll%2FtoEnroolPayConfirm%2F&response_type=code&scope=snsapi_base" +
                    "&state=" + result + "#wechat_redirect";
            }
        });
    }
</script>
</html>