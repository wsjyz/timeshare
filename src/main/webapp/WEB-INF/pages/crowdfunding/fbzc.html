<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>发起众筹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="众筹">
    <meta name="Keywords" content="众筹">
    <meta name="Description" content="众筹">

    <link rel="stylesheet" type="text/css" href="${request.contextPath}/css/crowdFunding/sm-extend.min.css">
    <link rel="stylesheet" type="text/css" href="${request.contextPath}/css/crowdFunding/style.css">
    <link rel="stylesheet" href="${request.contextPath}/css/upload.css">
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <script type='text/javascript' src='${request.contextPath}/js/zepto.min.js' charset='utf-8'></script>
    <script type="text/javascript" src="${request.contextPath}/js/crowdFunding/config.js"></script>
</head>
<body>
<div class="page-group">
    <div class="page page-current">
        <!--header start-->
        <header class="bar bar-nav"><h1 class="title">发起</h1></header>
        <!--header end-->
        <!--页面内容区域 start-->
        <div class="content">
            <section class="from-list">
                <form action="${request.contextPath}/crowdFunding/save" method="post" id="publishCrowdFunding">
                    <label class="form-group">
                        <span class="input-label">项目名称</span>
                        <input type="text" name="projectName" id="projectName" class="form-control" placeholder="项目名称">
                    </label>
                    <label class="form-group">
                        <span class="input-label">课程开始时间</span>
                        <input type="text" name="curriculumStartTime" class="form-control" placeholder="课程开始时间" id="startTime">
                    </label>
                    <label class="form-group">
                        <span class="input-label">课程结束时间</span>
                        <input type="text" name="curriculumEndTime" class="form-control" placeholder="课程结束时间" id="endTime">
                    </label>
                    <label class="form-group">
                        <span class="input-label">主办地址</span>
                        <input type="text" name="sponsorCity" class="form-control" placeholder="主办地址" id="address" value="">
                    </label>
                    <label class="form-group">
                        <span class="input-label">详情描述</span>
                        <textarea rows="5" name="detail" id="detail" class="form-control" placeholder="详情描述"></textarea>
                    </label>
                    <div class="radio-group">
                        <label><input type="radio" name="costType" value="AA" id="costBetween" checked>费用均摊</label>
                        <label><input type="radio" name="costType" value="FIXED_PRICE" id="price"> 一口价</label>
                    </div>
                    <label class="form-group">
                        <span class="input-label" id="costSpan">总费用</span>
                        <input type="number" name="costTotal" id="costTotal" class="form-control" placeholder="总费用">
                    </label>
                    <label class="form-group">
                        <span class="input-label">最少人数</span>
                        <input type="number" name="minPeoples" class="form-control" placeholder="最少人数">
                    </label>
                    <label class="form-group">
                        <span class="input-label">最多人数</span>
                        <input type="number" name="maxPeoples" id="maxPeoples" class="form-control" placeholder="最多人数">
                    </label>
                    <label class="form-group">
                        <span class="input-label">预约费用</span>
                        <input type="number" name="reservationCost" class="form-control" placeholder="预约费用">
                    </label>
                    <label class="form-group">
                        <span class="input-label">众筹封面</span>
                        <!--<input type="file" class="form-file">-->

                        <img src="" id="imageUrl" name="imageUrl" style="display: none;margin: 0 auto;height: 9rem;width: 16rem;"/>
                        <div class="main-wrap">
                            <div id="uploader">
                                <div class="queueList fix">
                                    <div class="filelist"></div>
                                    <div id="filePicker">
                                        <label class="trigger">+</label>
                                        <input type="file" name="file" class="webuploader-element-invisible" accept="image/*">
                                    </div>
                                </div>
                                <div class="progress-box">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div><div class="info"></div>
                                </div>
                            </div>
                        </div>




                    </label>
                    <div class="radio-group">
                        <span class="input-label">是否在轮播图显示:</span>
                        <label><input type="radio" name="isShow" value="YES" id="isShowYes" checked>是</label>
                        <label><input type="radio" name="isShow" value="NO" id="isShowNo">否</label>
                    </div>
                    <div class="content-block">
                        <div class="row">
                            <div class="col-33"><input type="button" id="sketch" class="button button-big btn-dark" value="保存草稿"></div>
                            <div class="col-33"><input type="button" id="publish" class="button button-big btn-dark" value="发 布"></div>
                            <div class="col-33"><a href="javascript:preview();" class="button button-big btn-light open-popup" data-popup=".popup-preview">预 览</a></div>

                        </div>
                    </div>
                    <input type="hidden" name="crowdfundingStatus" id="crowdfundingStatus" value="RELEASED">
                    <input type="hidden" name="imgUrl" id="imgUrl" value="">
                </form>
            </section>
        </div>
        <!-- 页面内容区域 end -->
    </div>
</div>

    <!-- 预览弹窗的框 -->
    <div class="popup popup-preview" style="display:none">
        <div class="content-block">
            <p><a href="#" class="close-popup">关闭</a></p>
            <div class="details">
                <div class="item-box">
                    <div class="zc-img"><img src="" id="previewImage"></div>
                    <div class="zc-text">
                        <div class="zc-name"><em class="tag">预览中</em><div id="previewProjectName"></div></div>
                        <div class="zc-info">
                            <span class="time"><i class="i-time"></i>上课时间:<div id="previewCurriculumEndTime"></div></span>
                            <span class="address"><i class="i-address"></i><div id="previewSponsorCity"></div></span>
                        </div>
                        <div class="dashed-line"></div>
                        <div class="zc-info">
                            <span class="price">众筹最低学费:<span id="previewPrice"></span>元</span>
                            <span class="num">学员人数:0/<span id="previewMaxPeoples"></span>人</span>
                        </div>
                        <div class="row cb">
                            <div class="col-50">课程总成本:<span id="priviewCostTotal"></span></div>
                            <div class="col-50">目前人均价:<span id="priviewAATotal"></span></div>
                        </div>
                        <div class="zc-progress">
                            <div class="progress"><div class="progress-bar" style="width:1%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-block details-content">
                <p id="previewDetail"></p>
            </div>
        </div>
    </div>
<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm.min.js"></script>
<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm-extend.min.js"></script>
<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/sm-city-picker.min.js"></script>
<script type="text/javascript" src="${request.contextPath}/js/crowdFunding/my-js.js"></script>
<script type='text/javascript' src='${request.contextPath}/js/upload.js?v=20160720-2' charset='utf-8'></script>
</body>
<script type="application/javascript">
    $(function() {
        /*发布众筹页面时间选择*/
        $(document).on("pageInit", function() {
            //初始化开始时间
            $("#startTime").datetimePicker({
            });
        });
        $(document).on("pageInit", function() {
            //初始化结束时间
            $("#endTime").datetimePicker({
            });
        });
        $(document).on("pageInit", function() {


            //初始化主办地址
            $("#address").cityPicker({
                toolbarTemplate: '<header class="bar bar-nav"><button class="button button-link pull-right close-picker">确定</button><h1 class="title">选择主办地址</h1></header>'
            });

            //费用均摊单击事件
            $("#costBetween").click(function() {
                $("#costSpan").text("总费用");
                $("#costTotal").attr("placeholder","总费用");

            });
            //一口价单击事件
            $("#price").click(function() {
                $("#costSpan").text("单价");
                $("#costTotal").attr("placeholder","单价");
            });


            //发布
            $("#publish").click(function() {
                var imageUrl = $('#imageUrl')[0].src;
                $("#imgUrl").val(imageUrl);
                $("#crowdfundingStatus").val("RELEASED");
                $.post('${request.contextPath}/crowdFunding/save', $("#publishCrowdFunding").serialize(), function (result) {
                    if (result == "success") {
                        $.toast("发布成功");
                        window.location.href = "${request.contextPath}/crowdFunding/toMyCrowdFunding";
                    }
                    else{
                        $.toast("发布失败");
                    }
                });
            });
            //保存草稿
            $("#sketch").click(function() {
                $("#crowdfundingStatus").val("SKETCH");
                $.post('${request.contextPath}/crowdFunding/save', $("#publishCrowdFunding").serialize(), function (result) {
                    if (result == "success") {
                        $.toast("草稿保存成功");
                    }
                    else{
                        $.toast("草稿保存失败");
                    }
                });
            });
        });
        // 默认必须要执行$.init()
        $.init();

    });
    function preview(){
        var imageUrl = $('#imageUrl')[0].src;
        $("#previewImage").attr("src",imageUrl);
        $("#previewProjectName").text($("#projectName").val());

        $("#previewCurriculumEndTime").text($("#endTime").val());
        $("#previewSponsorCity").text($("#address").val());


        //最低学费
        //一口价
        if($("#price").attr("checked")){
            if($("#costTotal").val()!=null){
                $("#previewPrice").text($("#costTotal").val());
            }
        }
        else{
            //费用分摊 默认显示最低价 即除以最大人数
            if($("#costTotal").val()!=null && $("#maxPeoples").val()!=null){
                $("#previewPrice").text($("#costTotal").val()/$("#maxPeoples").val());
            }
        }
        $("#previewMaxPeoples").text($("#maxPeoples").val());
        $("#priviewCostTotal").text($("#costTotal").val());
        $("#priviewAATotal").text($("#costTotal").val());
        $("#previewDetail").text($("#detail").val());
    }

</script>
</html>